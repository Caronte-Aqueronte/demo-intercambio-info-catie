<nz-layout class="main-layout min-h-screen">
  <!-- SIDEBAR DESKTOP/TABLET -->
  <nz-sider
    class="hidden md:block"
    nzCollapsible
    [(nzCollapsed)]="isCollapsed"
    [nzWidth]="240"
    [nzCollapsedWidth]="80"
    [nzTrigger]="null"
  >
    <a class="logo block p-4" routerLink="/dashboard">
      @if (!isCollapsed) {
      <img
        src="/img/logo-blanco.png"
        alt="Logo Empresa"
        class="mx-auto h-20 w-auto object-contain transition-opacity duration-200"
        aria-label="Ir al inicio"
      />
      } @else {
      <img
        src="/img/logo-escudo-blanco.png"
        alt="Logo Empresa (compacto)"
        class="mx-auto h-8 w-8 object-contain transition-opacity duration-200"
        aria-label="Ir al inicio"
      />
      }
    </a>

    <ng-container *ngTemplateOutlet="menuTpl"></ng-container>
  </nz-sider>

  <nz-layout>
    <nz-header>
      <div class="flex justify-between items-center w-full px-3">
        <button
          class="md:hidden"
          (click)="mobileOpen = true"
          aria-label="Abrir menú"
        >
          <nz-icon nzType="menu-unfold"></nz-icon>
        </button>

        <span class="hidden md:inline-flex">
          <nz-icon
            class="trigger cursor-pointer"
            [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'"
            (click)="isCollapsed = !isCollapsed"
          ></nz-icon>
        </span>

        <div class="flex-1 md:flex-none"></div>

        <div class="flex items-center gap-3">
          <div class="flex items-center gap-2 hidden sm:inline">
            <nz-icon nzType="user"></nz-icon>
            <span class="font-semibold hidden sm:inline">
              Bienvenido, {{ userFirstName }}
            </span>
          </div>
          <button nz-button nzType="primary" nzDanger (click)="onLogout()">
            <nz-icon nzType="logout"></nz-icon>
            Salir
          </button>
        </div>
      </div>
    </nz-header>

    <!-- BREADCRUMB + CONTENIDO -->
    <nz-content class="bg-gray-50">
      <div class="px-3 md:px-6 py-3 md:py-4">
        <div class="inner-content rounded-md shadow-sm p-3">
          <router-outlet></router-outlet>
        </div>
      </div>
    </nz-content>
  </nz-layout>
</nz-layout>

<!-- DRAWER MÓVIL -->
<nz-drawer
  [nzVisible]="mobileOpen"
  (nzOnClose)="mobileOpen = false"
  nzPlacement="left"
  [nzWidth]="260"
  [nzBodyStyle]="{ padding: 0, backgroundColor: '#0b1a2b', color: '#fff' }"
  [nzClosable]="true"
  [nzTitle]="drawerTitle"
  nzWrapClassName="custom-drawer"
>
  <ng-template #drawerTitle>
    <div class="flex items-center gap-2">
      <img
        src="img/logo-blanco.png"
        alt="Logo Empresa"
        class="h-10 w-auto object-contain"
      />
    </div>
  </ng-template>

  <ng-container *nzDrawerContent>
    <ng-container *ngTemplateOutlet="menuTpl"></ng-container>
  </ng-container>
</nz-drawer>

<ng-template #menuTpl>
  <ul
    nz-menu
    nzMode="inline"
    (click)="mobileOpen = false"
    class="w-full !bg-transparent !text-white"
  >
    <!-- Documentos -->
    <li nz-menu-item [routerLink]="['/dashboard/documents']">
      <nz-icon nzType="file-text" nzTheme="outline"></nz-icon>
      <span>Documentos</span>
    </li>

    <!-- Mapas -->
    <li nz-menu-item [routerLink]="['/dashboard/maps']">
      <nz-icon nzType="environment" nzTheme="outline"></nz-icon>
      <span>Mapas</span>
    </li>
  </ul>
</ng-template>
